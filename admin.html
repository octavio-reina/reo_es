<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Modo Admin ‚Äì Diccionario</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 1rem;
    }
    h1, h2 {
      color: #00695c;
      text-align: center;
    }
    input, textarea, button {
      width: 100%;
      padding: 0.7rem;
      margin: 0.5rem 0;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #00796b;
      color: white;
      border: none;
      cursor: pointer;
    }
    .oculto {
      display: none;
    }
    nav {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }
    .tab-btn {
      background: #e0f2f1;
      border: none;
      padding: 0.7rem 1.5rem;
      cursor: pointer;
      font-weight: bold;
    }
    .tab-btn.active {
      background: #00796b;
      color: white;
    }
    #estado {
      color: green;
      font-weight: bold;
    }
    #error {
      color: red;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
    }
    th {
      background: #e0f2f1;
    }
    .acciones button {
      margin: 2px;
      padding: 0.4rem;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>Modo Administrador</h1>
  <div id="clave">
    <p>Ingresa la clave secreta para continuar:</p>
    <input type="password" id="codigo" placeholder="Clave secreta">
    <button onclick="verificarClave()">Entrar</button>
  </div>

  <div id="admin" class="oculto">
    <nav>
      <button class="tab-btn active" onclick="mostrarSeccion('agregar')">Agregar</button>
      <button class="tab-btn" onclick="mostrarSeccion('gestionar')">Gestionar</button>
    </nav>

    <div id="estado"></div>
    <div id="error"></div>

    <div id="agregar">
      <h2 id="titulo-form">Agregar nueva palabra</h2>
      <input type="text" id="reo" placeholder="Reo Tahiti">
      <input type="text" id="espanol" placeholder="Espa√±ol">
      <input type="text" id="categoria" placeholder="Categor√≠a">
      <textarea id="notas" placeholder="Notas"></textarea>
      <button onclick="guardar()">Guardar</button>
    </div>

    <div id="gestionar" class="oculto">
      <input type="text" id="busqueda" placeholder="Buscar..." oninput="filtrarTabla()">
      <table id="tabla">
        <thead>
          <tr>
            <th>ID</th>
            <th>Reo Tahiti</th>
            <th>Espa√±ol</th>
            <th>Categor√≠a</th>
            <th>Notas</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const CLAVE_SECRETA = "maitaimaitai";
    const URL_BASE = "https://script.google.com/macros/s/AKfycbwZwQCGXgoxE6kSx4N609NlUAdHT9Cbu8Oxr0Q7Y5McH95bctkihDZ1Ow8b-lonx2a0/exec";
    let editandoID = null;

    function verificarClave() {
      if (document.getElementById("codigo").value.trim() === CLAVE_SECRETA) {
        document.getElementById("clave").style.display = "none";
        document.getElementById("admin").classList.remove("oculto");
        cargarTabla();
      } else {
        alert("Clave incorrecta.");
      }
    }

    function mostrarSeccion(seccion) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('#agregar, #gestionar').forEach(sec => sec.classList.add('oculto'));
      document.getElementById(seccion).classList.remove('oculto');
      document.querySelector(`.tab-btn[onclick*='${seccion}']`).classList.add('active');
    }

    function cargarTabla() {
      fetch(URL_BASE + "?accion=leer")
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#tabla tbody");
          tbody.innerHTML = "";
          data.forEach(palabra => {
            const fila = document.createElement("tr");
            fila.innerHTML = `
              <td>${palabra.id}</td>
              <td>${palabra.reo}</td>
              <td>${palabra.espanol}</td>
              <td>${palabra.categoria}</td>
              <td>${palabra.notas}</td>
              <td class="acciones">
                <button onclick='editar(${JSON.stringify(palabra)})'>‚úèÔ∏è</button>
                <button onclick='eliminar(${palabra.id})'>üóëÔ∏è</button>
              </td>
            `;
            tbody.appendChild(fila);
          });
        });
    }

    function filtrarTabla() {
      const query = document.getElementById("busqueda").value.toLowerCase();
      document.querySelectorAll("#tabla tbody tr").forEach(row => {
        const texto = row.innerText.toLowerCase();
        row.style.display = texto.includes(query) ? "" : "none";
      });
    }

    function editar(palabra) {
      document.getElementById("reo").value = palabra.reo;
      document.getElementById("espanol").value = palabra.espanol;
      document.getElementById("categoria").value = palabra.categoria;
      document.getElementById("notas").value = palabra.notas;
      editandoID = palabra.id;
      mostrarSeccion('agregar');
      document.getElementById("titulo-form").textContent = `Editando palabra ID ${palabra.id}`;
    }

    function mostrarEstado(mensaje) {
      let segundos = 5;
      const estado = document.getElementById("estado");
      estado.textContent = `${mensaje} (${segundos})`;
      const intervalo = setInterval(() => {
        segundos--;
        if (segundos > 0) {
          estado.textContent = `${mensaje} (${segundos})`;
        } else {
          clearInterval(intervalo);
          estado.textContent = "";
        }
      }, 1000);
    }

    function guardar() {
      const reo = encodeURIComponent(document.getElementById("reo").value.trim());
      const espanol = encodeURIComponent(document.getElementById("espanol").value.trim());
      const categoria = encodeURIComponent(document.getElementById("categoria").value.trim());
      const notas = encodeURIComponent(document.getElementById("notas").value.trim());
      if (!reo || !espanol) return document.getElementById("error").textContent = "Reo Tahiti y Espa√±ol son obligatorios.";

      let url = `${URL_BASE}?reo=${reo}&espanol=${espanol}&categoria=${categoria}&notas=${notas}`;
      if (editandoID) url += `&accion=editar&id=${editandoID}`;

      fetch(url)
        .then(res => res.text())
        .then(data => {
          if (data.trim() === "OK") {
            mostrarEstado(editandoID ? "‚úÖ Palabra actualizada" : "‚úÖ Palabra agregada");
            document.getElementById("error").textContent = "";
            document.getElementById("reo").value = "";
            document.getElementById("espanol").value = "";
            document.getElementById("categoria").value = "";
            document.getElementById("notas").value = "";
            document.getElementById("titulo-form").textContent = "Agregar nueva palabra";
            editandoID = null;
            cargarTabla();
          } else {
            document.getElementById("estado").textContent = "";
            document.getElementById("error").textContent = "‚ùå Error: " + data;
          }
        });
    }

    function eliminar(id) {
      if (!confirm("¬øEliminar esta palabra?")) return;
      fetch(`${URL_BASE}?accion=eliminar&id=${id}`)
        .then(res => res.text())
        .then(data => {
          if (data.trim() === "OK") {
            mostrarEstado("‚úÖ Palabra eliminada");
            cargarTabla();
          } else {
            document.getElementById("error").textContent = "‚ùå Error al eliminar: " + data;
          }
        });
    }
  </script>
</body>
</html>
